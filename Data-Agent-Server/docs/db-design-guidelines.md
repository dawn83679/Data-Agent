# 数据库设计规范

## 1. 文件管理规范

- **文件位置**：`src/main/resources/db/`
- **文件命名**：`{序号}{模块名}.sql`（序号5位数字，从00001开始）
- **文件结构**：表定义、注释、索引定义

---

## 2. 表结构设计规范

### 2.1 必需字段

- **主键**：`id BIGSERIAL PRIMARY KEY` (PostgreSQL) / `BIGINT AUTO_INCREMENT PRIMARY KEY` (MySQL)
- **逻辑删除**：`delete_flag SMALLINT DEFAULT 0`（0未删除/1已删除）
- **时间字段**：`created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`、`updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`

### 2.2 可选审计字段

根据业务需求决定是否添加：
- **创建人/更新人**：`created_by BIGINT NOT NULL`、`updated_by BIGINT NOT NULL`
- **适用场景**：管理类表（角色、权限）需要，用户基础信息表通常不需要

---

## 3. 命名规范

- **表命名**：小写+下划线，模块前缀（`sys_`系统表、`biz_`业务表）+业务名称
- **字段命名**：小写+下划线，禁止使用`is_`前缀，外键使用`{表名}_id`格式
- **索引命名**：`idx_{表名}_{字段名1}_{字段名2}`

---

## 4. 数据类型选择规范

- **数值类型**：主键用`BIGINT/BIGSERIAL`，状态标志用`SMALLINT/TINYINT`，金额用`DECIMAL`
- **字符串类型**：根据实际需求设置长度（50/100/255/500/1000），禁止滥用`TEXT`
- **时间类型**：优先使用`TIMESTAMP`，设置`DEFAULT CURRENT_TIMESTAMP`
- **状态标志**：禁止使用`BOOLEAN`，统一使用`SMALLINT`(PostgreSQL)或`TINYINT`(MySQL)

---

## 5. 索引设计规范

- **创建原则**：必须理解业务场景，与需求方沟通后再创建
- **建议创建场景**：频繁WHERE条件、JOIN关联、ORDER BY排序、组合查询条件
- **不需要创建场景**：主键（自动）、UNIQUE字段（自动）、很少查询、小表、频繁更新字段
- **复合索引**：遵循最左前缀原则，区分度高的字段放前面

---

## 6. 注释规范

- **强制要求**：表注释和字段注释必须清晰描述业务含义、用途、取值范围
- **使用英文注释**，外键字段需说明引用关系

---

## 7. 表关系设计规范

- **一对一(1:1)**：使用唯一外键
- **一对多(1:N)**：在"多"的一方添加外键
- **多对多(N:M)**：使用中间关联表，包含两个外键和联合唯一约束
- **外键约束**：建议在应用层维护，不使用数据库外键约束

---

## 8. 约束和默认值规范

- **NOT NULL**：必填业务字段设置，可选字段允许NULL
- **UNIQUE**：保证唯一性的字段设置
- **DEFAULT**：时间字段`CURRENT_TIMESTAMP`，状态标志合理默认值，计数器`0`
- **CHECK**：简单值域检查可使用，复杂逻辑在应用层

---

## 9. 设计原则

- **遵守数据库范式**：避免字段冗余，严格遵守1NF/2NF/3NF
- **合理反范式**：统计字段、快照数据、缓存字段可适当冗余

---

## 10. 禁止事项

- **严禁使用**：视图、存储过程、函数、触发器（除非用户明确要求）
- **禁止滥用**：过大VARCHAR、TEXT/LONGTEXT、数据库存储文件、SELECT *、过度索引
- **字段设计禁忌**：BOOLEAN类型、`is_`前缀、保留关键字、中文字段名、驼峰命名、字段过多（>30）
